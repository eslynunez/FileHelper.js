(function(e){"use strict";var t=e.document,n=function(e){return t.getElementById(e)},a=e.sessionStorage,i=function(){return e.Blob},l=n("canvas"),r=n("canvas-options"),s=n("canvas-filename"),o=n("canvas-clear"),f=n("text"),d=n("text-options"),u=n("text-filename"),p=n("html"),h=n("html-options"),c=n("html-filename"),m=n("reader"),v=n("reader-options"),g=n("reader-file"),x=l.getContext("2d"),E=false,y=a.x_points||[],w=a.y_points||[],L=a.drag_points||[],S=function(e,t,n){y.push(e);w.push(t);L.push(n)},_=function(){l.width=l.width;x.lineWidth=6;x.lineJoin="round";x.strokeStyle="#000000";var e=0,t=y.length;for(;e<t;e++){x.beginPath();if(e&&L[e]){x.moveTo(y[e-1],w[e-1])}else{x.moveTo(y[e]-1,w[e])}x.lineTo(y[e],w[e]);x.closePath();x.stroke()}},N=function(){E=false},T=function(e){var t="h6 h5 h4 h3 h2 h1".split(" "),n=t.length,a,i;while(n--){a=e.getElementsByTagName(t[n]);for(var l=0,r=a.length;l<r;l++){i=a[l].textContent.trim();if(i){return i}}}},J=t.implementation,b=function(e){var t=J.createDocumentType("html",null,null),n=J.createDocument("http://www.w3.org/1999/xhtml","html",t),a=n.documentElement,i=a.appendChild(n.createElement("head")),l=i.appendChild(n.createElement("meta")),r=i.appendChild(n.createElement("title")),s=a.appendChild(n.createElement("body")),o=0,f=e.childNodes.length;l.setAttribute("charset",e.ownerDocument.characterSet);for(;o<f;o++){s.appendChild(n.importNode(e.childNodes.item(o),true))}var d=T(n);if(d){r.appendChild(n.createTextNode(d))}return n};g.addEventListener("change",function(e){fileHelper.readUploadedJSONFile(e.target.id,function(t){var n=e.target||e.srcElement;m.value+=JSON.stringify(t)})},false);l.width=500;l.height=300;if(typeof y==="string"){y=JSON.parse(y)}if(typeof w==="string"){w=JSON.parse(w)}if(typeof L==="string"){L=JSON.parse(L)}if(a.canvas_filename){s.value=a.canvas_filename}if(a.text){f.value=a.text}if(a.text_filename){u.value=a.text_filename}if(a.html){p.innerHTML=a.html}if(a.html_filename){c.value=a.html_filename}E=true;_();E=false;o.addEventListener("click",function(){l.width=l.width;y.length=w.length=L.length=0},false);l.addEventListener("mousedown",function(e){e.preventDefault();E=true;S(e.pageX-l.offsetLeft,e.pageY-l.offsetTop,false);_()},false);l.addEventListener("mousemove",function(e){if(E){S(e.pageX-l.offsetLeft,e.pageY-l.offsetTop,true);_()}},false);l.addEventListener("mouseup",N,false);l.addEventListener("mouseout",N,false);r.addEventListener("submit",function(e){e.preventDefault();l.toBlobHD(function(e){fileHelper.saveAs(e,(s.value||s.placeholder)+".png")},"image/png")},false);d.addEventListener("submit",function(e){e.preventDefault();var n=i();fileHelper.saveAs(new n([f.value||f.placeholder],{type:"text/plain;charset="+t.characterSet}),(u.value||u.placeholder)+".txt")},false);h.addEventListener("submit",function(e){e.preventDefault();var n=i(),a=new XMLSerializer,l=b(p);fileHelper.saveAs(new n([a.serializeToString(l)],{type:"text/plain;charset="+t.characterSet}),(c.value||c.placeholder)+".xhtml")},false);e.addEventListener("unload",function(){a.x_points=JSON.stringify(y);a.y_points=JSON.stringify(w);a.drag_points=JSON.stringify(L);a.canvas_filename=s.value;a.text=f.value;a.text_filename=u.value;a.html=p.innerHTML;a.html_filename=c.value},false)})(self);
